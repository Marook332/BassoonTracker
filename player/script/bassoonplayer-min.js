var e=1,t=2,r=3,n=8,a=9,i=10,o=11,s=12,u=13,p=16,l=24,d=26,f=28,m=29,c=33,v=36,g=46,h=53,P=54,b=55,T=56,F=1,y=2,S=0,A=1,C=2,w=7,k=1,V=2,x=3,M=1,E=2,D={C1:{prd:856,name:"C-1",tune:[907,900,894,887,881,875,868,862,856,850,844,838,832,826,820,814]},Cs1:{prd:808,name:"C#1",tune:[856,850,844,838,832,826,820,814,808,802,796,791,785,779,774,768]},D1:{prd:762,name:"D-1",tune:[808,802,796,791,785,779,774,768,762,757,752,746,741,736,730,725]},Ds1:{prd:720,name:"D#1",tune:[762,757,752,746,741,736,730,725,720,715,709,704,699,694,689,684]},E1:{prd:678,name:"E-1",tune:[720,715,709,704,699,694,689,684,678,674,670,665,660,655,651,646]},F1:{prd:640,name:"F-1",tune:[678,675,670,665,660,655,651,646,640,637,632,628,623,619,614,610]},Fs1:{prd:604,name:"F#1",tune:[640,636,632,628,623,619,614,610,604,601,597,592,588,584,580,575]},G1:{prd:570,name:"G-1",tune:[604,601,597,592,588,584,580,575,570,567,563,559,555,551,547,543]},Gs1:{prd:538,name:"G#1",tune:[570,567,563,559,555,551,547,543,538,535,532,528,524,520,516,513]},A1:{prd:508,name:"A-1",tune:[538,535,532,528,524,520,516,513,508,505,502,498,495,491,487,484]},As1:{prd:480,name:"A#1",tune:[508,505,502,498,494,491,487,484,480,477,474,470,467,463,460,457]},B1:{prd:453,name:"B-1",tune:[480,477,474,470,467,463,460,457,453,450,447,444,441,437,434,431]},C2:{prd:428,name:"C-2",tune:[453,450,447,444,441,437,434,431,428,425,422,419,416,413,410,407]},Cs2:{prd:404,name:"C#2",tune:[428,425,422,419,416,413,410,407,404,401,398,395,392,390,387,384]},D2:{prd:381,name:"D-2",tune:[404,401,398,395,392,390,387,384,381,379,376,373,370,368,365,363]},Ds2:{prd:360,name:"D#2",tune:[381,379,376,373,370,368,365,363,360,357,355,352,350,347,345,342]},E2:{prd:339,name:"E-2",tune:[360,357,355,352,350,347,345,342,339,337,335,332,330,328,325,323]},F2:{prd:320,name:"F-2",tune:[339,337,335,332,330,328,325,323,320,318,316,314,312,309,307,305]},Fs2:{prd:302,name:"F#2",tune:[320,318,316,314,312,309,307,305,302,300,298,296,294,292,290,288]},G2:{prd:285,name:"G-2",tune:[302,300,298,296,294,292,290,288,285,284,282,280,278,276,274,272]},Gs2:{prd:269,name:"G#2",tune:[285,284,282,280,278,276,274,272,269,268,266,264,262,260,258,256]},A2:{prd:254,name:"A-2",tune:[269,268,266,264,262,260,258,256,254,253,251,249,247,245,244,242]},As2:{prd:240,name:"A#2",tune:[254,253,251,249,247,245,244,242,240,239,237,235,233,232,230,228]},B2:{prd:226,name:"B-2",tune:[240,238,237,235,233,232,230,228,226,225,224,222,220,219,217,216]},C3:{prd:214,name:"C-3",tune:[226,225,223,222,220,219,217,216,214,213,211,209,208,206,205,204]},Cs3:{prd:202,name:"C#3",tune:[214,212,211,209,208,206,205,203,202,201,199,198,196,195,193,192]},D3:{prd:190,name:"D-3",tune:[202,200,199,198,196,195,193,192,190,189,188,187,185,184,183,181]},Ds3:{prd:180,name:"D#3",tune:[190,189,188,187,185,184,183,181,180,179,177,176,175,174,172,171]},E3:{prd:170,name:"E-3",tune:[180,179,177,176,175,174,172,171,170,169,167,166,165,164,163,161]},F3:{prd:160,name:"F-3",tune:[170,169,167,166,165,164,163,161,160,159,158,157,156,155,154,152]},Fs3:{prd:151,name:"F#3",tune:[160,159,158,157,156,155,154,152,151,150,149,148,147,146,145,144]},G3:{prd:143,name:"G-3",tune:[151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136]},Gs3:{prd:135,name:"G#3",tune:[143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128]},A3:{prd:127,name:"A-3",tune:[135,134,133,132,131,130,129,128,127,126,125,125,124,123,122,121]},As3:{prd:120,name:"A#3",tune:[127,126,125,125,123,123,122,121,120,119,118,118,117,116,115,114]},B3:{prd:113,name:"B-3",tune:[120,119,118,118,117,116,115,114,113,113,112,111,110,109,109,108]}},N={None:{name:"---"},C0:{name:"C-0",prd:6848},Cs0:{name:"C#0",prd:6464},D0:{name:"D-0",prd:6096},Ds0:{name:"D#0",prd:5760},E0:{name:"E-0",prd:5424},F0:{name:"F-0",prd:5120},Fs0:{name:"F#0",prd:4832},G0:{name:"G-0",prd:4560},Gs0:{name:"G#0",prd:4304},A0:{name:"A-0",prd:4064},As0:{name:"A#0",prd:3840},B0:{name:"B-0",prd:3624},C1:{name:"C-1",prd:3424},Cs1:{name:"C#1",prd:3232},D1:{name:"D-1",prd:3048},Ds1:{name:"D#1",prd:2880},E1:{name:"E-1",prd:2712},F1:{name:"F-1",prd:2560},Fs1:{name:"F#1",prd:2416},G1:{name:"G-1",prd:2280},Gs1:{name:"G#1",prd:2152},A1:{name:"A-1",prd:2032},As1:{name:"A#1",prd:1920},B1:{name:"B-1",prd:1812},C2:{name:"C-2",prd:1712},Cs2:{name:"C#2",prd:1616},D2:{name:"D-2",prd:1524},Ds2:{name:"D#2",prd:1440},E2:{name:"E-2",prd:1356},F2:{name:"F-2",prd:1280},Fs2:{name:"F#2",prd:1208},G2:{name:"G-2",prd:1140},Gs2:{name:"G#2",prd:1076},A2:{name:"A-2",prd:1016},As2:{name:"A#2",prd:960},B2:{name:"B-2",prd:906},C3:{name:"C-3",prd:856},Cs3:{name:"C#3",prd:808},D3:{name:"D-3",prd:762},Ds3:{name:"D#3",prd:720},E3:{name:"E-3",prd:678},F3:{name:"F-3",prd:640},Fs3:{name:"F#3",prd:604},G3:{name:"G-3",prd:570},Gs3:{name:"G#3",prd:538},A3:{name:"A-3",prd:508},As3:{name:"A#3",prd:480},B3:{name:"B-3",prd:453},C4:{name:"C-4",prd:428},Cs4:{name:"C#4",prd:404},D4:{name:"D-4",prd:381},Ds4:{name:"D#4",prd:360},E4:{name:"E-4",prd:339},F4:{name:"F-4",prd:320},Fs4:{name:"F#4",prd:302},G4:{name:"G-4",prd:285},Gs4:{name:"G#4",prd:269},A4:{name:"A-4",prd:254},As4:{name:"A#4",prd:240},B4:{name:"B-4",prd:226.5,modPrd:226},C5:{name:"C-5",prd:214},Cs5:{name:"C#5",prd:202},D5:{name:"D-5",prd:190.5,modPrd:190},Ds5:{name:"D#5",prd:180},E5:{name:"E-5",prd:169.5,modPrd:170},F5:{name:"F-5",prd:160},Fs5:{name:"F#5",prd:151},G5:{name:"G-5",prd:142.5,modPrd:143},Gs5:{name:"G#5",prd:134.5,modPrd:135},A5:{name:"A-5",prd:127},As5:{name:"A#5",prd:120},B5:{name:"B-5",prd:113.25,modPrd:113},C6:{name:"C-6",prd:107},Cs6:{name:"C#6",prd:101},D6:{name:"D-6",prd:95.25,modPrd:95},Ds6:{name:"D#6",prd:90},E6:{name:"E-6",prd:84.75,modPrd:85},F6:{name:"F-6",prd:80},Fs6:{name:"F#6",prd:75.5,modPrd:75},G6:{name:"G-6",prd:71.25,modPrd:71},Gs6:{name:"G#6",prd:67.25,modPrd:67},A6:{name:"A-6",prd:63.5,modPrd:63},As6:{name:"A#6",prd:60},B6:{name:"B-6",prd:56.625,modPrd:56},C7:{name:"C-7",prd:53.5,modPrd:53},Cs7:{name:"C#7",prd:50.5,modPrd:50},D7:{name:"D-7",prd:47.625,modPrd:47},Ds7:{name:"D#7",prd:45},E7:{name:"E-7",prd:42.375,modPrd:42},F7:{name:"F-7",prd:40},Fs7:{name:"F#7",prd:37.75,modPrd:37},G7:{name:"G-7",prd:35.625,modPrd:35},Gs7:{name:"G#7",prd:33.625,modPrd:33},A7:{name:"A-7",prd:31.75,modPrd:31},As7:{name:"A#7",prd:30},B7:{name:"B-7",prd:28.3125,modPrd:28},C8:{name:"C-8",prd:26.75},Cs8:{name:"C#8",prd:25.25},D8:{name:"D-8",prd:23.8125},Ds8:{name:"D#8",prd:22.5},E8:{name:"E-8",prd:21.1875},F8:{name:"F-8",prd:20},Fs8:{name:"F#8",prd:18.875},G8:{name:"G-8",prd:17.8125},Gs8:{name:"G#8",prd:16.8125},A8:{name:"A-8",prd:15.875},As8:{name:"A#8",prd:15},B8:{name:"B-8",prd:14.15625},C9:{name:"C-9",prd:13.375},Cs9:{name:"C#9",prd:12.625},D9:{name:"D-9",prd:11.90625},Ds9:{name:"D#9",prd:11.25},E9:{name:"E-9",prd:10.59375},F9:{name:"F-9",prd:10},Fs9:{name:"F#9",prd:9.4375},G9:{name:"G-9",prd:8.90625},Gs9:{name:"G#9",prd:8.40625},A9:{name:"A-9",prd:7.9375},As9:{name:"A#9",prd:7.5},B9:{name:"B-9",prd:7.078125},C10:{name:"C-10",prd:6.6875},Cs10:{name:"C#10",prd:6.3125},D10:{name:"D-10",prd:5.953125},Ds10:{name:"D#10",prd:5.625},E10:{name:"E-10",prd:5.296875},F10:{name:"F-10",prd:5},Fs10:{name:"F#10",prd:4.71875},G10:{name:"G-10",prd:4.453125},Gs10:{name:"G#10",prd:4.203125},A10:{name:"A-10",prd:3.96875},As10:{name:"A#10",prd:3.75},B10:{name:"B-10",prd:3.5390625},C11:{name:"C-11",prd:3.34375},Cs11:{name:"C#11",prd:3.15625},D11:{name:"D-11",prd:2.9765625},Ds11:{name:"D#11",prd:2.8125},E11:{name:"E-11",prd:2.6484375},F11:{name:"F-11",prd:2.5},Fs11:{name:"F#11",prd:2.359375},G11:{name:"G-11",prd:2.2265625},Gs11:{name:"G#11",prd:2.1015625},A11:{name:"A-11",prd:1.984375},As11:{name:"A#11",prd:1.875},B11:{name:"B-11",prd:1.76953125},OFF:{name:"OFF",prd:0}},B=145,_=1,G=2,I={stereoSeparation:V,eB:!0};function U(e,t){var r={index:0,litteEndian:!t};function n(e){(e=0===e?e:e||r.index)<0&&(e=0),e>=r.length&&(e=r.length-1),r.index=e}return r.goto=function(e){n(e)},r.jump=function(e){this.goto(this.index+e)},r.rB=function(e){n(e);var t=this.dV.getInt8(this.index);return this.index++,t},r.rU=function(e){n(e);var t=this.dV.getUint8(this.index);return this.index++,t},r.rUI=function(e){n(e);var t=this.dV.getUint32(this.index,this.litteEndian);return this.index+=4,t},r.rBs=function(e,t,r){n(t),r||(r=new Uint8Array(e));for(var a=this.index,i=0;i<e;i++)r[i]=this.dV.getInt8(a+i);return this.index+=e,r},r.rS=function(e,t){n(t);var r=this.index,a=this.dV,i="";for((e+=r)>this.length&&(e=this.length);r<e;++r){var o=a.getUint8(r);if(0==o)break;i+=String.fromCharCode(o)}return this.index=e,i},r.rdW=function(e){n(e);var t=this.dV.getUint16(this.index,this.litteEndian);return this.index+=2,t},r.readLong=r.rdD=r.rUI,r.readShort=function(e,t){n(t);var r=this.dV.getInt16(this.index,this.litteEndian);return this.index+=2,r},r.isEOF=function(e){return this.index>=this.length-(e=e||0)},r.toString=function(){return(new TextDecoder).decode(e)},e&&(r.buffer=e,r.dV=new DataView(e),r.length=e.byteLength),r}var O=function(){var e={data:[],length:0,name:"",bits:8,volume:64,finetune:0,ftX:0,panning:0,rN:0,loop:{enabled:!1,start:0,length:0,type:0}};return e};const R={},H={on:(e,t)=>(R[e]=R[e]||[],R[e].push(t),R[e].length),off:(e,t)=>{let r=R[e];r&&(r[t-1]=void 0)},tr:(e,t)=>{let r=R[e];r&&r.length&&r.forEach((r=>{r&&r(t,e)}))}};let W=function(){var e,t,r,n,a={},i=70,o=0,s=L.context;return(e=s.createGain()).gain.value=1,t=e,a.volumeValue=function(e){if(void 0!==e){i=e;var t=e/100;r.gain.value=t*t}return i},a.panningValue=function(e,t){return void 0!==e&&n.pan.setValueAtTime(o=e,t||L.context.currentTime),o},a.setState=function(){},a.input=function(){return e},a.output=function(){return t},t=e,n=n||L.context.createStereoPanner(),t.connect(n),t=n,r=r||s.createGain(),t.connect(r),a.volumeValue(i),a};var L=function(){var e,t,r,n,a,i,o={};window.AudioContext=window.AudioContext||window.webkitAudioContext;var s,p,d=[],m=V,v=0,g=[[],[],[]],h=0,P=4143.569;return AudioContext&&(e=new AudioContext),o.init=function(u,v){if(o.context=e=u=u||e,u){s=!!L.context.createStereoPanner,p=!1,function(i,s){(r=i.createGain()).gain.setValueAtTime(1,0),r.connect(s||i.destination),(t=i.createGain()).connect(r),o.setMasterVolume(1),(n=i.createBiquadFilter()).type="lowpass",n.frequency.setValueAtTime(2e4,0),(a=e.createBiquadFilter()).type="highshelf",a.frequency.value=1200,a.gain.value=4,n.connect(a),a.connect(t),o.masterVolume=t,o.cutOffVolume=r,o.lowPassfilter=n}(u,v);var g=ee.getTrackCount();for(d=[],i=0;i<g;i++)h();o.filterChains=d,o.usePanning=s,H.on(l,(function(e){for(i=d.length;i<e;i++)h();H.tr(c,e),o.sSS(m)})),H.on(f,(function(e){o.sSS()}))}function h(){var e=W();e.output().connect(n),d.push(e)}},o.enable=function(){r.gain.setValueAtTime(1,0),o.cutOff=!1},o.disable=function(){r.gain.setValueAtTime(0,0),o.cutOff=!0;g.forEach((function(e,t){e.forEach((function(e){e.gain.cancelScheduledValues(0),e.gain.setValueAtTime(0,0)})),g[t]=[]}))},o.checkState=function(){e&&"suspended"===e.state&&e.resume&&e.resume()},o.playSample=function(t,r,n,a,l,f,m){var c;c=e,o.enable(),r=r||428,void 0===a&&(a=p?Editor.getCrTrack():0),f=f||e.currentTime,m===B&&(n=0);var v,b,T,F=ee.gin(t),y=r,S=0;if(F){var A,C,w=0,k=0;n=void 0===n?100*F.sample.volume/64:n,S=(F.sample.panning||0)/128,ee.iFM()?ee.ulf?r-=F.gft()/2:F.gft()&&(r=o.gftForNote(m,F.gft())):F.gft()&&(r=o.gftForPrd(r,F.gft())),C=o.getSampleRateForPrd(r);var V=1;F.sample.data.length?(k=F.sample.data.length,l&&l.offset&&(l.offset.value>=k&&(l.offset.value=k-1),w=l.offset.value/c.sampleRate),A=c.createBuffer(1,k,c.sampleRate),V=C/c.sampleRate):(A=c.createBuffer(1,1,c.sampleRate),w=0);var x=A.getChannelData(0);for(i=0;i<k;i++)x[i]=F.sample.data[i];P=C;var M=c.createBufferSource();M.buffer=A;var E=c.createGain();if(E.gain.value=n/100,E.gain.setValueAtTime(n/100,f),F.sample.loop.enabled&&F.sample.loop.length>2&&(I.unrollLoops||(M.loop=!0,M.loopStart=F.sample.loop.start/c.sampleRate,M.loopEnd=(F.sample.loop.start+F.sample.loop.length)/c.sampleRate)),F.ve.enabled||F.pe.enabled||F.hasVibrato()){var D=F.noteOn(f),N=M;D.volume&&(M.connect(v=D.volume),N=v),D.panning&&(N.connect(b=D.panning),N=b),T=D.scheduled,N.connect(E)}else M.connect(E);var _=L.context.createGain();if(ee.iFM()?(_.gain.setValueAtTime(0,f),_.gain.linearRampToValueAtTime(1,f+.01)):_.gain.setValueAtTime(1,f),E.connect(_),s){var G=L.context.createStereoPanner();G.pan.setValueAtTime(S,f),_.connect(G),G.connect(d[a].input())}else _.connect(d[a].input());M.playbackRate.value=V;M.start(f+0,w);var U={source:M,volume:E,panning:G,ve:v,pe:b,vFO:_,startVolume:n,cV:n,startPrd:r,basePrd:y,noteIndex:m,sPR:V,sampleRate:C,iI:t,effects:l,track:a,time:f,scheduled:T};return g[h].push(E),H.tr(u,U),U}return{}},o.sSS=function(e){var t,r=ee.getTrackCount();if(ee.iFM())t=0;else switch(m=e=e||m,e){case x:t=0,I.stereoSeparation=x;break;case k:t=1,I.stereoSeparation=k;break;default:t=.3,I.stereoSeparation=V}for(i=0;i<r;i++){var n=d[i];n&&n.panningValue(i%4==0||i%4==3?-t:t)}},o.getPrevSampleRate=function(){return P},o.context=e,o.getSemiToneFrom=function(e,t,r){var n=e;if(r&&((e=o.gftBasePrd(e,r))||(e=n)),t){var a=X[e];if(a){var i=Y.indexOf(a.name),s=Y[i+t];if(s){var u=J[s];u&&(n=u.prd,r&&(n=o.gftForPrd(n,r)))}}}return n},o.getNearestSemiTone=function(e,t){var r,n,a,i=e,s=1e5,u=ee.gin(t);if(ee.iFM()){var p=0;Q.forEach((function(t,r){(n=t.prd)&&(a=Math.abs(n-e))<s&&(s=a,i=n,p=r)})),p&&u&&u.gft()&&(ee.ulf?i-=u.gft()/2:i=o.gftForNote(p,u.gft()))}else{var l=8;for(r in t&&u&&u.sample.finetune&&(l+=u.sample.finetune),D)D.hasOwnProperty(r)&&(n=D[r].tune[l],(a=Math.abs(n-e))<s&&(s=a,i=n))}return i},o.gftForPrd=function(e,t){var r=e,n=X[e];if(n&&n.tune){var a=8+t;a>=0&&a<n.tune.length&&(r=n.tune[a])}return r},o.gftForNote=function(e,t){if(e===B)return 1;var r=Q[e],n=t>0?Q[e+1]:Q[e-1];if(r&&n){var a=Math.abs(n.prd-r.prd)/127;return r.prd-a*t}return r?r.prd:1e5},o.gftBasePrd=function(e,t){var r=e,n=Z[t];return n&&(r=n[e]),r},o.getSampleRateForPrd=function(e){return ee.iFM()?ee.ulf?8363*Math.pow(2,(4608-e)/768):3579364/e:3546895/e},o.limitAmigaPrd=function(e){return e=Math.max(e,113),e=Math.min(e,856)},o.setAmigaLowPassFilter=function(e,t){n.frequency.setValueAtTime(e?2e3:21e3,t)},o.setMasterVolume=function(r,n){r*=.7,t.gain.setValueAtTime(v,n=n||e.currentTime),t.gain.linearRampToValueAtTime(r,n+.02),v=r},o.slideMasterVolume=function(r,n){t.gain.linearRampToValueAtTime(r*=.7,n=n||e.currentTime),v=r},o.gLM=function(){return v/.7},o.cSNC=function(){++h>2&&(h=0),g[h]=[]},o.wFn={sine:function(e,t,r,n){return e+Math.sin(t*r*.8)*n*1.7},saw:function(e,t,r,n){var a=1-Math.abs(t*r/7%1);return e+(a=(a=2*a-1)*n*-2)},square:function(e,t,r,n){var a=Math.sin(t*r)<=0?-1:1;return e+(a=a*n*2)},sawInverse:function(e,t,r,n){var a=Math.abs(t*r/7%1);return e+(a=(a=2*a-1)*n*-2)}},o}(),q=function(){var e={};function t(t,r,n){var a=ee.getProperties().tickTime,i=t.sustain?t.sustainPoint+1:t.count;t.loopStartPoint=Math.min(t.loopStartPoint,t.count-1),t.loopEndPoint=Math.min(t.loopEndPoint,t.count-1);var o=t.loop&&t.loopStartPoint<t.loopEndPoint;t.sustain&&t.sustainPoint<=t.loopStartPoint&&(o=!1),o&&(i=t.loopEndPoint+1);var s=0;if(r.gain)var u=r.gain,p=0,l=64;else u=r.pan,p=32,l=32;u.setValueAtTime((t.ps[0][1]-p)/l,n);for(var d=1;d<i;d++){var f=t.ps[d];u.linearRampToValueAtTime((f[1]-p)/l,n+(s=f[0]*a))}return!!o&&e.scheduleEnvelopeLoop(r,n,2,s)}return e.type="sample",e.name="",e.iI=0,e.sampleIndex=-1,e.fadeout=128,e.data=[],e.samples=[O()],e.sample=e.samples[0],e.ve={raw:[],enabled:!1,points:[[0,48],[10,64],[20,40],[30,18],[40,28],[50,18]],count:6},e.pe={raw:[],enabled:!1,points:[[0,32],[20,40],[40,24],[60,32],[80,32]],count:5},e.vibrato={},e.sNfN=[],e.play=function(t,r,n,a,i,o){return ee.iFM()&&(r=e.gN(t)),L.playSample(e.iI,r,n,a,i,o,t)},e.noteOn=function(r){var n,a,i={};if(e.ve.enabled){n=L.context.createGain();var o=e.ve,s=t(o,n,r);s&&(i.volume=r+s)}return e.pe.enabled&&L.usePanning&&(a=L.context.createStereoPanner(),(s=t(o=e.pe,a,r))&&(i.panning=r+s)),e.vibrato.rate&&e.vibrato.depth&&(i.ticks=0,i.vibrato=r,i.vibratoFunction=e.getAutoVibratoFunction()),{volume:n,panning:a,scheduled:i}},e.noteOff=function(t,r){if(r&&r.volume){if(ee.iFM()){var n=ee.getProperties().tickTime;if(e.ve.enabled){if(e.ve.sustain&&r.ve){u();var a=0,i=e.ve.ps[e.ve.sustainPoint];i&&(a=i[0]*n);for(var o=e.ve.sustainPoint;o<e.ve.count;o++){var s=e.ve.ps[o];s&&r.ve.gain.linearRampToValueAtTime(s[1]/64,t+s[0]*n-a)}}if(e.fadeout)r.vFO.gain.linearRampToValueAtTime(0,t+65536/e.fadeout*n/2)}else u(),r.vFO.gain.linearRampToValueAtTime(0,t+.1);if(e.pe.enabled&&L.usePanning&&r.pe)for(a=0,(i=e.pe.ps[e.pe.sustainPoint])&&(a=i[0]*n),o=e.pe.sustainPoint;o<e.pe.count;o++)(s=e.pe.ps[o])&&r.pe.pan.linearRampToValueAtTime((s[1]-32)/32,t+s[0]*n-a);return 100}if(u(),!r.isKey||!r.volume)return 0;r.volume.gain.linearRampToValueAtTime(0,t+.5)}function u(){r.volume.gain.cancelScheduledValues(t),r.vFO.gain.cancelScheduledValues(t),r.ve&&r.ve.gain.cancelScheduledValues(t),r.pe&&r.pe.pan.cancelScheduledValues(t),r.scheduled=void 0}},e.scheduleEnvelopeLoop=function(t,r,n,a){a=a||0;var i=ee.getProperties().tickTime;if(t.gain)var o=e.ve,s=t.gain,u=0,p=64;else o=e.pe,s=t.pan,u=32,p=32;var l=o.ps[o.loopStartPoint],d=l[0];if(o.loop&&o.loopStartPoint<o.loopEndPoint)for(;a<n;)for(var f=a,m=o.loopStartPoint;m<=o.loopEndPoint;m++)s.linearRampToValueAtTime(((l=o.ps[m])[1]-u)/p,r+(a=f+(l[0]-d)*i));return a},e.scheduleAutoVibrato=function(t,r){var n=0;t.scheduled.ticks=t.scheduled.ticks||0;var a,i,o,s,u=ee.getProperties().tickTime,p=-e.vibrato.rate/40,l=e.vibrato.depth/8;for(ee.ulf&&(l*=4),t.source&&(a=t.startPrd,i=t.scheduled.vibratoFunction||L.wFn.sine,o=t.scheduled.vibrato||L.context.currentTime,s=0);n<r;){if(n+=u,a){var d=1;e.vibrato.sweep&&t.scheduled.ticks<e.vibrato.sweep&&(d=1-(e.vibrato.sweep-t.scheduled.ticks)/e.vibrato.sweep);var f=i(a,t.scheduled.ticks,p,l*d);ee.setPrdAtTime(t,f,o+s*u),s++}t.scheduled.ticks++}return n},e.getAutoVibratoFunction=function(){switch(e.vibrato.type){case 1:return L.wFn.square;case 2:return L.wFn.saw;case 3:return L.wFn.sawInverse}return L.wFn.sine},e.resetVolume=function(t,r){if(r.vFO&&(r.vFO.gain.cancelScheduledValues(t),r.vFO.gain.setValueAtTime(1,t)),r.ve){r.ve.gain.cancelScheduledValues(t);var n=ee.getProperties().tickTime,a=e.ve.sustain?e.ve.sustainPoint+1:e.ve.count;r.ve.gain.setValueAtTime(e.ve.ps[0][1]/64,t);for(var i=1;i<a;i++){var o=e.ve.ps[i];r.ve.gain.linearRampToValueAtTime(o[1]/64,t+o[0]*n)}}},e.gft=function(){return ee.iFM()?e.sample.ftX:e.sample.finetune},e.sft=function(t){ee.iFM()?(e.sample.ftX=t,e.sample.finetune=t>>4):(t>7&&(t-=16),e.sample.finetune=t,e.sample.ftX=t<<4)},e.gN=function(t,r){var n=0;return ee.ulf?(n=7680-64*(t-1),r&&(n-=e.gft()/2)):(n=Q[t].prd,r&&e.gft()&&(n=L.gftForNote(t,e.gft()))),n},e.setSampleForNoteIndex=function(t){var r=e.sNfN[t-1];r!==e.sampleIndex&&"number"==typeof r&&e.setSampleIndex(r)},e.setSampleIndex=function(t){e.sampleIndex!==t&&(e.sample=e.samples[t],e.sampleIndex=t,H.tr(v,e.iI))},e.hasSamples=function(){for(var t=0,r=e.samples.length;t<r;t++)if(e.samples[t].length)return!0},e.hasVibrato=function(){return e.vibrato.rate&&e.vibrato.depth},e},z=function(){var e={prd:0,index:0,effect:0,instrument:0,param:0,volumeEffect:0,setPrd:function(t){e.prd=t,e.index=$[t]||0},setIndex:function(t){e.index=t;var r=Q[t];r?(e.prd=r.modPrd||r.prd,1===e.prd&&(e.prd=0)):e.prd=0},clear:function(){e.instrument=0,e.prd=0,e.effect=0,e.param=0,e.index=0,e.volumeEffect=0}};return e};let K=function(){let e={},t={unknown:{name:"UNKNOWN",type:S},unsupported:{name:"UNSUPPORTED",type:S},m_p:{name:"PROTRACKER",isMod:!0,type:A,loader:function(){return function(){var e={load:function(e,t){ee.strM(_,!0),ee.ulf=!1,ee.cleariNs(31);var r={patterns:[],restartPos:1},n=4;r.typeId=e.rS(4,1080),r.title=e.rS(20,0),"2CHN"===r.typeId&&(n=2),"3CHN"===r.typeId&&(n=3),"5CHN"===r.typeId&&(n=5),"6CHN"===r.typeId&&(n=6),"7CHN"===r.typeId&&(n=7),"8CHN"===r.typeId&&(n=8),"9CHN"===r.typeId&&(n=9),"10CH"===r.typeId&&(n=10),"11CH"===r.typeId&&(n=11),"12CH"===r.typeId&&(n=12),"13CH"===r.typeId&&(n=13),"14CH"===r.typeId&&(n=14),"15CH"===r.typeId&&(n=15),"16CH"===r.typeId&&(n=16),"18CH"===r.typeId&&(n=18),"20CH"===r.typeId&&(n=20),"22CH"===r.typeId&&(n=22),"24CH"===r.typeId&&(n=24),"26CH"===r.typeId&&(n=26),"28CH"===r.typeId&&(n=28),"30CH"===r.typeId&&(n=30),"32CH"===r.typeId&&(n=32),r.channels=n;var a=0;for(d=1;d<=31;++d){var i=e.rS(22),o=e.rdW(),s=q();s.name=i,s.sample.length=s.sample.realLen=o<<1;var u=e.rU();u>16&&(u%=16),u>7&&(u-=16),s.sft(u),s.sample.volume=e.rU(),s.sample.loop.start=e.rdW()<<1,s.sample.loop.length=e.rdW()<<1,s.sample.loop.enabled=s.sample.loop.length>2,s.sample.loop.type=M,s.pointer=a,a+=s.sample.length,s.setSampleIndex(0),ee.setiN(d,s)}r.instruments=ee.gins(),e.goto(950),r.length=e.rU(),e.jump(1);for(var p=[],l=0,d=0;d<128;++d)p[d]=e.rU(),p[d]>l&&(l=p[d]);for(r.patternTable=p,e.goto(1084),d=0;d<=l;++d){for(var f=[],c=0;c<64;c++){var v,g=[];for(v=0;v<n;v++){var h=z(),P=e.rUI();h.setPrd(P>>16&4095),h.effect=P>>8&15,h.instrument=P>>24&240|P>>12&15,h.param=255&P,g.push(h)}for(v=n;v<ee.getTrackCount();v++)g.push(z());f.push(g)}r.patterns.push(f)}var b=[];for(d=1;d<=31;d++)if(s=ee.gin(d)){var T=s.sample.length;for(let t=0;t<T;t++){var F=e.rB();t<2&&(F=0),s.sample.data.push(F/127)}b.push({label:d+" "+s.name,data:d})}return H.tr(m,b),r}};return e}()}},mod_SoundTracker:{name:"SOUNDTRACKER",isMod:!0,type:A,loader:function(){return function(){var e={load:function(e,t){ee.strM(_,!0),ee.ulf=!1,ee.cleariNs(15);var r={patterns:[],restartPos:1,typeId:"ST",channels:4};r.title=e.rS(20,0);var n=0;for(p=1;p<=15;++p){var a=e.rS(22),i=e.rdW(),o=q();o.name=a,o.sample.length=o.realLen=i<<1,o.sample.volume=e.rdW(),o.sft(0),o.sample.loop.start=e.rdW(),o.sample.loop.length=e.rdW()<<1,o.sample.loop.enabled=o.sample.loop.length>2,o.sample.loop.type=M,o.pointer=n,n+=o.sample.length,o.setSampleIndex(0),ee.setiN(p,o)}r.instruments=ee.gins(),e.goto(470),r.length=e.rU(),r.speed=e.rU();for(var s=[],u=0,p=0;p<128;++p)s[p]=e.rU(),s[p]>u&&(u=s[p]);for(r.patternTable=s,e.goto(600),p=0;p<=u;++p){for(var l=[],d=0;d<64;d++){var f,c=[];for(f=0;f<4;f++){var v={},g=e.rUI();v.prd=g>>16&4095,v.effect=g>>8&15,v.instrument=g>>24&240|g>>12&15,v.param=255&g,c.push(v)}for(f=4;f<ee.getTrackCount();f++)c.push({note:0,effect:0,instrument:0,param:0});l.push(c)}r.patterns.push(l)}var h=[];for(p=1;p<=15;p++)if(o=ee.gin(p)){var P=o.sample.length;for(let t=0;t<P;t++){var b=e.rB();t<2&&(b=0),o.sample.data.push(b/127)}h.push({label:p+" "+o.name,data:p})}return H.tr(m,h),r}};return e}()}},mod_FastTracker:{name:"FT",isMod:!0,type:A,loader:function(){return function(){var e={load:function(t){ee.strM(G,!0),ee.cleariNs(1);var r={},n={patterns:[],instruments:[]};t.litteEndian=!0,t.goto(17),n.title=t.rS(20),t.jump(1),r.trackerName=t.rS(20),r.trackerVersion=t.rB(),r.trackerVersion=t.rB()+"."+r.trackerVersion,r.headerSize=t.rdD(),r.songlength=t.rdW(),r.restartPos=t.rdW(),r.numberOfChannels=t.rdW(),r.numberOfPts=t.rdW(),r.numberOfiNs=t.rdW(),r.flags=t.rdW(),ee.ulf=r.flags%2==1,r.defaultTempo=t.rdW(),r.defaultBPM=t.rdW();for(var a=[],i=0,o=0;o<r.songlength;++o)a[o]=t.rU(),i<a[o]&&(i=a[o]);n.patternTable=a,n.length=r.songlength,n.channels=r.numberOfChannels,n.restartPos=r.restartPos+1;var s=60+r.headerSize;for(t.goto(s),o=0;o<r.numberOfPts;o++){var u=[],p={};p.headerSize=t.rdD(),p.packingType=t.rU(),p.patternLength=t.rdW(),p.patternSize=t.rdW(),t.goto(s+=p.headerSize);for(var l=0;l<p.patternLength;l++){var d,f=[];for(d=0;d<r.numberOfChannels;d++){var c=z(),v=t.rU();128&v?(1&v&&c.setIndex(t.rU()),2&v&&(c.instrument=t.rU()),4&v&&(c.volumeEffect=t.rU()),8&v&&(c.effect=t.rU()),16&v&&(c.param=t.rU())):(c.setIndex(v),c.instrument=t.rU(),c.volumeEffect=t.rU(),c.effect=t.rU(),c.param=t.rU()),f.push(c)}u.push(f)}t.goto(s+=p.patternSize),n.patterns.push(u)}var g=[];for(o=1;o<=r.numberOfiNs;++o){var h=q();try{if(h.filePos=t.index,h.headerSize=t.rdD(),h.name=t.rS(22),h.type=t.rU(),h.nS=t.rdW(),h.samples=[],h.sHS=0,h.nS>0){let e=function(e){for(e.ps=[],P=0;P<12;P++)e.ps.push(e.raw.slice(2*P,2*P+2));return 1&e.type&&(e.enabled=!0),2&e.type&&(e.sustain=!0),4&e.type&&(e.loop=!0),e};h.sHS=t.rdD(),h.sHS=Math.max(h.sHS,40),h.sHS>200&&(h.sHS=40);for(var P=0;P<96;P++)h.sNfN.push(t.rU());for(P=0;P<24;P++)h.ve.raw.push(t.rdW());for(P=0;P<24;P++)h.pe.raw.push(t.rdW());h.ve.count=t.rU(),h.pe.count=t.rU(),h.ve.sustainPoint=t.rU(),h.ve.loopStartPoint=t.rU(),h.ve.loopEndPoint=t.rU(),h.pe.sustainPoint=t.rU(),h.pe.loopStartPoint=t.rU(),h.pe.loopEndPoint=t.rU(),h.ve.type=t.rU(),h.pe.type=t.rU(),h.vibrato.type=t.rU(),h.vibrato.sweep=t.rU(),h.vibrato.depth=Math.min(t.rU(),15),h.vibrato.rate=t.rU(),h.fadeout=t.rdW(),h.reserved=t.rdW(),h.ve=e(h.ve),h.pe=e(h.pe)}}catch(w){}if(t.goto(s+=h.headerSize),0===h.nS){var b=O();h.samples.push(b)}else{if(t.isEOF(1))break;for(var T=0;T<h.nS;T++)(b=O()).length=t.rdD(),b.loop.start=t.rdD(),b.loop.length=t.rdD(),b.volume=t.rU(),b.ftX=t.rB(),b.type=t.rU(),b.panning=t.rU()-128,b.rN=t.rB(),b.reserved=t.rB(),b.name=t.rS(22),b.bits=8,h.samples.push(b),t.goto(s+=h.sHS);for(T=0;T<h.nS;T++)if((b=h.samples[T]).length){s+=b.length,16&b.type&&(b.bits=16,b.type^=16,b.length>>=1,b.loop.start>>=1,b.loop.length>>=1),b.loop.type=b.type||0,b.loop.enabled=!!b.loop.type;var F=b.length,y=0;if(16===b.bits)for(var S=0;S<F;S++){var A=t.readShort()+y;A<-32768?A+=65536:A>32767&&(A-=65536),y=A,b.data.push(A/32768)}else for(S=0;S<F;S++)(A=t.rB()+y)<-128?A+=256:A>127&&(A-=256),y=A,b.data.push(A/127);if(b.loop.type===E){var C=b.data.slice(b.loop.start,b.loop.start+b.loop.length);b.data=b.data.slice(0,b.loop.start+b.loop.length),b.data=b.data.concat(C.reverse()),b.loop.length=2*b.loop.length,b.length=b.loop.start+b.loop.length}t.goto(s)}}h.setSampleIndex(0),ee.setiN(o,h),g.push({label:o+" "+h.name,data:o})}return H.tr(m,g),n.instruments=ee.gins(),ee.setBPM(r.defaultBPM),ee.sAS(r.defaultTempo),e.validate(n),n},validate:function(e){function t(e,t){var r=!0;if(e.ps&&e.ps[0])if(0===e.ps[0][0])for(var n=0,a=1;a<e.count;a++){var i=e.ps[a];i&&i[0]>n?n=i[0]:r=!1}else r=!1;else r=!1;return r?e:"volume"===t?{raw:[],enabled:!1,points:[[0,48],[10,64],[20,40],[30,18],[40,28],[50,18]],count:6}:{raw:[],enabled:!1,points:[[0,32],[20,40],[40,24],[60,32],[80,32]],count:5}}e.instruments.forEach((function(e){e.ve=t(e.ve,"volume"),e.pe=t(e.pe,"panning");for(var r=e.samples.length-1,n=0,a=e.sNfN.length;n<a;n++)e.sNfN[n]=Math.min(e.sNfN[n],r)}))}};return e}()}},sample:{name:"SAMPLE",isSample:!0,type:C},zip:{name:"ZIP"},gzip:{name:"GZIP"}};return e.detect=function(e,r){let n=e.length,a="";if((r=r||"").endsWith(".pls"))return t.playlist;if(r.endsWith(".m3u"))return t.playlist;if(r.endsWith(".json")){try{if(JSON.parse(e.toString()).modules)return t.playlist}catch(s){}return t.unknown}if(a=e.rS(17,0),"Extended Module: "===a)return t.mod_FastTracker;n>1100&&(a=e.rS(4,1080));if("M.K."===a)return t.m_p;if("M!K!"===a)return t.m_p;if("M&K!"===a)return t.m_p;if("FLT4"===a)return t.m_p;for(let u=2;u<10;u++)if(a===u+"CHN")return t.m_p;for(let u=10;u<32;u++)if(a===u+"CH")return t.m_p;let i="";if(r&&r.indexOf(".")>0&&(i=r.split(".").pop()),i=i.toLowerCase(),"wav"===i)return t.sample;if("mp3"===i)return t.sample;if("iff"===i)return t.sample;if("flac"===i)return t.sample;if("ogg"===i)return t.sample;if("opus"===i)return t.sample;if("zip"===i)return t.zip;if("PK"===e.rS(2,0))return t.zip;let o=e.rBs(2,0);if(31===o[0]&&139===o[1])return t.gzip;if(r&&r.indexOf(".")>=0&&n>1624){let r=function(e){return e<128};if(function(){e.goto(0);for(let n=0;n<20;n++)if(!r(e.rB()))return!1;let t=0,a=0;for(let n=0;n<15;n++){for(let t=0;t<22;t++)if(!r(e.rB()))return!1;if(e.jump(-22),e.rS(22).toLowerCase().startsWith("st-")&&(a+=10),a>20)return!0;t+=e.rdW(),e.jump(6)}return 2*t+1624<=n}())return t.mod_SoundTracker}return t.sample},e}();!function(e,t,r){function n(r,i){if(!t[r]){if(!e[r]){var o="function"==typeof require&&require;if(!i&&o)return o(r,!0);if(a)return a(r,!0);throw new Error("'"+r+"'")}var s=t[r]={exports:{}};e[r][0].call(s.exports,(function(t){var a=e[r][1][t];return n(a||t)}),s,s.exports)}return t[r].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i])}({1:[function(e,t,r){var n=e("./lib/WAAClock");t.exports=n,"undefined"!=typeof window&&(window.WAAClock=n)},{"./lib/WAAClock":2}],3:[function(e,t,r){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var r=[];return window.addEventListener("message",(function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),r.length>0&&r.shift()())}),!0),function(e){r.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(e){throw new Error("")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("")}},{}],2:[function(e,t,r){var n=e("__browserify_process");if("undefined"!=typeof window&&!AudioContext)throw new Error("");var a=.1,i=.001,o=function(e,t,r){this.clock=e,this.func=r,this.repeatTime=null,this.toleranceLate=a,this.toleranceEarly=i,this._armed=!1,this._latestTime=null,this._earliestTime=null,this.schedule(t)};o.prototype.clear=function(){return this.clock._removeEvent(this),this},o.prototype.repeat=function(e){if(0===e)throw new Error("");return this.repeatTime=e,this},o.prototype.tolerance=function(e){return"number"==typeof e.late&&(this.toleranceLate=e.late),"number"==typeof e.early&&(this.toleranceEarly=e.early),this._update(),this},o.prototype.isRepeated=function(){return null!==this.repeatTime},o.prototype.schedule=function(e){this._armed=!0,this.deadline=e,this._update(),this.clock.context.currentTime>=this._earliestTime&&(this.clock._removeEvent(this),this._execute())},o.prototype._execute=function(){this._armed=!1,this.clock.context.currentTime<this._latestTime?this.func(this):H&&H.tr(g),!1===this._armed&&this.isRepeated()&&this.schedule(this.deadline+this.repeatTime)},o.prototype._update=function(){this._latestTime=this.deadline+this.toleranceLate,this._earliestTime=this.deadline-this.toleranceEarly,this.clock._removeEvent(this),this.clock._insertEvent(this)};var s=t.exports=function(e,t){this.toleranceEarly=(t=t||{}).toleranceEarly||i,this.toleranceLate=t.toleranceLate||a,this.context=e,this._events=[],this._started=!1};s.prototype.setTimeout=function(e,t){return this._createEvent(e,this._absTime(t))},s.prototype.callbackAtTime=function(e,t){return this._createEvent(e,t)},s.prototype.timeStretch=function(e,t,r){var n=this.context.currentTime;return t.forEach((function(t){t.isRepeated()&&t.repeat(t.repeatTime*r);var a=e+r*(t.deadline-e);if(t.isRepeated())for(;n>=a-t.toleranceEarly;)a+=t.repeatTime;t.schedule(a)})),t},s.prototype.start=function(){if(!1===this._started){var e=this;this._started=!0,this._events=[];this._clockNode=this.context.createScriptProcessor(256,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){n.nextTick((function(){e._tick()}))}}},s.prototype.stop=function(){!0===this._started&&(this._started=!1,this._clockNode.disconnect())},s.prototype._tick=function(){for(var e=this._events.shift();e&&e._earliestTime<=this.context.currentTime;)e._execute(),e=this._events.shift();e&&this._events.unshift(e)},s.prototype._createEvent=function(e,t){var r=new o(this,t,e);return r.tolerance({late:this.toleranceLate,early:this.toleranceEarly}),r},s.prototype._insertEvent=function(e){this._events.splice(this._indexByTime(e._earliestTime),0,e)},s.prototype._removeEvent=function(e){var t=this._events.indexOf(e);-1!==t&&this._events.splice(t,1)},s.prototype._indexByTime=function(e){for(var t,r=0,n=this._events.length;r<n;)t=Math.floor((r+n)/2),this._events[t]._earliestTime<e?r=t+1:n=t;return r},s.prototype._absTime=function(e){return e+this.context.currentTime},s.prototype._relTime=function(e){return e-this.context.currentTime}},{__browserify_process:3}]},{},[1]);const j=WAAClock;var X={},Z={},J={},Y=[],Q=[],$=[],ee=function(){var u,c={};c.isMaster=!0;var v,g,A,C,k,V,x,M,E=!1,O=[],R=1,W=0,te=0,re=F,ne=0,ae=0,ie=125,oe=6,se=2.5/ie,ue=4,pe=64,le=_,de=[],fe=[],me=[],ce=[],ve=[];function ge(e){e=e||0,(u=u||new j(L.context)).start(),L.enable(),ce=[],ve=[];var t=(k=v.patterns[e]).length,r={},n=0,a=L.context.currentTime+.1,i=.2,o=k,s=ne;me=[],M=u.setTimeout((function(u){n>1&&M.repeat(i=1);var p=u.deadline+i;for(L.cSNC();a<p;){if(r.pause){if(!r.pasuseHandled){var l=a-L.context.currentTime;l>0&&setTimeout((function(){c.pause(),c.sAS(6)}),Math.round(1e3*l)+100),r.pasuseHandled=!0}return void(c.autoPlay&&H.tr(h,a-L.context.currentTime))}if(c.setStateAtTime(a,{patternPos:n,songPos:s}),r.pD){r.pD--;for(var d=0;d<ue;d++)Fe(d,a);a+=oe*se}else if(r=he(n,a,o,s),a+=oe*se,++n>=t||r.pBr){if(r.positionBreak&&r.targetSongPos==s||(ce=[],ve=[]),n=0,ee.getPlayType()==F){var f=r.positionBreak?r.targetSongPos:++s;c.autoPlay&&r.positionBreak&&f<s&&s>=v.length-2&&(f=v.length),f>=v.length&&(f=v.restartPos?v.restartPos-1:0,H.tr(h,a-L.context.currentTime)),f>=v.length&&(f=0),(o=v.patterns[e=v.patternTable[s=f]])||(o=Se(),v.patterns[e]=o),t=o.length,r.pBr&&(n=r.targetPtPos||0)>o.length&&(n=0)}else r.pBr&&(n=r.targetPtPos||0)>pe&&(n=0);H.tr(P,a-oe*se)}}for(d=0;d<ue;d++){var m=de[d];if(m&&m.time&&m.scheduled){var g=c.gin(m.iI);if(m.scheduled.volume&&a+i>=m.scheduled.volume){var b=g.scheduleEnvelopeLoop(m.ve,m.scheduled.volume,2);m.scheduled.volume+=b}m.scheduled.panning&&a+i>=m.scheduled.panning&&(b=g.scheduleEnvelopeLoop(m.pe,m.scheduled.panning,2),m.scheduled.panning+=b)}}}),.01).repeat(i).tolerance({early:.1})}function he(e,t,r,n){for(var a,i=(r=r||k)[e],o=ue,s={},u=0;u<o;u++)(p=i[u])&&p.effect&&15===p.effect&&(p.param<32?(ee.sAS(p.param),0===p.param&&(s.pause=!0)):ee.setBPM(p.param));for(u=0;u<o;u++){var p=i[u];if(p)(a=Pe(p,u,t,{position:n,step:e})).pBr&&(s.pBr=!0,s.targetPtPos=a.targetPtPos||0),a.positionBreak&&(s.positionBreak=!0,s.targetPtPos=a.targetPtPos||0,s.targetSongPos=a.targetSongPos||0),a.pD&&(s.pD=a.pD)}for(u=0;u<o;u++)Fe(u,t);return s}function Pe(e,t,r,n){var a=100,i={},o=e.instrument,s=e.prd,u=e.index;if(s&&!o&&(o=de[t].currentiN,a="number"==typeof de[t].cV?de[t].cV:a,I.eB&&o&&fe[t].offset&&fe[t].offset.instrument===o&&(i.offset=fe[t].offset)),"number"==typeof e.instrument&&(N=c.gin(e.instrument))&&(a=N.sample.volume/64*100,I.eB&&(fe[t].offset=fe[t].offset||{},fe[t].offset.value=0,fe[t].offset.instrument=e.instrument)),"number"==typeof o&&(N=c.gin(o)),I.useSampleSwapping&&N&&!s&&!c.iFM()){let e=de[t];if(e){let n=c.gin(e.iI),a=e.time,o=r-a,u=n.samples[0],p=N.samples[0];if(u){if(u.loop&&u.loop.enabled&&u.loop.length>0){let t=u.loop.length/e.sampleRate,n=a+u.loop.start/e.sampleRate+t;for(;n<r;)n+=t;r=n}else{let t=u.length/e.sampleRate;if(t>o){r+=t-o}}p.loop&&p.loop.enabled&&p.loop.length>0?(s=e.currentPrd,i.offset={value:p.loop.start,stepValue:p.loop.start}):be(t,r)}}}var p=a,l=!0;if(u&&c.iFM())if(97===u&&(u=B),u===B){var d=N||c.gin(de[t].currentiN);a=p=d?d.noteOff(r,de[t]):0,l=!1}else if(N&&(N.setSampleForNoteIndex(u),N.sample.rN&&(u+=N.sample.rN)),c.ulf)s=7680-64*(u-1);else{var f=Q[u];f&&(s=f.prd)}var m,v,g=e.param,h={};if(e.volumeEffect&&c.iFM()){var P=e.volumeEffect;if(m=P>>4,v=15&P,P>15&&P<=80)a=p=(P-16)/64*100,i.volume={value:p};else switch(m){case 6:i.fade={value:-1*v*100/64};break;case 7:i.fade={value:100*v/64};break;case 8:i.fade={value:100*-v/64,fine:!0};break;case 9:i.fade={value:100*v/64,fine:!0};break;case 10:case 11:case 14:case 15:break;case 12:i.panning={value:17*(P-192),slide:!1};break;case 13:i.panning={value:P,slide:!0}}}switch(e.effect){case 0:if(g){m=g>>4,v=15&g;var b=0;if(N=N||c.gin(de[t].currentiN),c.iFM()){if(N){var T=u||de[t].noteIndex,F=N.gN(T,!0);u===B?i.arpeggio=fe[t].arpeggio:(i.arpeggio={root:F,interval1:F-N.gN(T+m,!0),interval2:F-N.gN(T+v,!0),step:1},fe[t].arpeggio=i.arpeggio)}}else F=s||de[t].startPrd,N&&(b=N.gft())&&(F=L.gftForPrd(F,b)),i.arpeggio={root:F,interval1:F-L.getSemiToneFrom(F,m,b),interval2:F-L.getSemiToneFrom(F,v,b),step:1}}e.instrument&&(i.volume={value:a});break;case 1:g*=-1,c.iFM()&&!g&&fe[t].slideUp&&(g=fe[t].slideUp.value),i.slide={value:g},fe[t].slideUp=i.slide;break;case 2:c.iFM()&&!g&&fe[t].slideDown&&(g=fe[t].slideDown.value),i.slide={value:g},fe[t].slideDown=i.slide;break;case 3:l=!1;var y=s;if(c.iFM()&&u===B&&(y=0),de[t].currentiN&&(o=de[t].currentiN),y&&o)(N=c.gin(o))&&N.gft()&&(y=c.iFM()?N.gN(u,!0):L.gftForPrd(y,N.gft()));(C=fe[t].slide)&&(g||(g=C.value)),y||(y=fe[t].defaultSlideTarget),i.slide={value:g,target:y,canUseGlissando:!0,resetVolume:!!e.instrument,volume:a},fe[t].slide=i.slide,e.instrument&&(i.volume={value:a});break;case 4:e.instrument&&(de[t].startVolume&&(i.volume={value:p}),de[t].vibratoTimer=0);var S=(m=g>>4)*oe/64,A=fe[t].vibrato;0==m&&A&&(S=A.freq),0==(v=15&g)&&A&&(v=A.amplitude),i.vibrato={amplitude:v,freq:S},fe[t].vibrato=i.vibrato;break;case 5:var C;l=!1,(y=s)&&o&&(N=c.gin(o))&&N.gft()&&(y=c.iFM()?L.gftForNote(u,N.gft()):L.gftForPrd(y,N.gft())),g=1,(C=fe[t].slide)&&(y||(y=C.target||0),g=C.value),i.slide={value:g,target:y},fe[t].slide=i.slide,e.instrument&&(i.volume={value:a}),(g=e.param)&&(e.param<16?g*=-1:g=e.param>>4,i.fade={value:g=100*g/64,resetOnStep:!!e.instrument},fe[t].fade=i.fade);break;case 6:e.instrument&&(de[t].startVolume&&(i.volume={value:p}),de[t].vibratoTimer=0),e.param?(e.param<16?g*=-1:g=15&e.param,i.fade={value:g=100*g/64},fe[t].fade=i.fade):ee.iFM()&&fe[t].fade&&(i.fade=fe[t].fade),fe[t].vibrato&&(i.vibrato=fe[t].vibrato);break;case 7:s&&!e.instrument&&(de[t].startVolume&&(i.volume={value:p}),de[t].tremoloTimer=0);var w=v=15&g,k=(S=(m=g>>4)*oe/64,fe[t].tremolo);0==m&&k&&(S=k.freq),0==v&&k&&(w=k.amplitude),i.tremolo={amplitude:w,freq:S},fe[t].tremolo=i.tremolo;break;case 8:i.panning={value:g,slide:!1};break;case 9:!(g<<=8)&&fe[t].offset&&(g=fe[t].offset.stepValue||fe[t].offset.value||0);var M=g;I.eB&&!e.instrument&&fe[t].offset&&(g+=fe[t].offset.value),i.offset={value:g,stepValue:M},fe[t].offset=fe[t].offset||{},fe[t].offset.value=i.offset.value,fe[t].offset.stepValue=i.offset.stepValue,I.eB&&(e.instrument&&(fe[t].offset.instrument=e.instrument),s&&(fe[t].offset.value+=M)),e.instrument&&(i.volume={value:a});break;case 10:if(e.param<16?g*=-1:g=e.param>>4,g=100*g/64,!e.param){var E=fe[t].fade;E&&(g=E.value)}i.fade={value:g,resetOnStep:!!e.instrument},c.iFM()&&(fe[t].fade=i.fade);break;case 11:h.pBr=!0,h.positionBreak=!0,h.targetSongPos=e.param,h.targetPtPos=0;break;case 12:i.volume={value:p=e.param/64*100};break;case 13:h.pBr=!0,h.targetPtPos=10*(m=g>>4)+(v=15&g);break;case 14:var D=15&g;switch(g>>4){case 0:c.iFM()||L.setAmigaLowPassFilter(!D,r);break;case 1:!(D*=-1)&&fe[t].fS&&(D=fe[t].fS.value),i.slide={value:D,fine:!0},fe[t].fS=i.slide;break;case 2:!D&&fe[t].fS&&(D=fe[t].fS.value),i.slide={value:D,fine:!0},fe[t].fS=i.slide;break;case 3:fe[t].glissando=!!D;break;case 4:switch(D){case 1:case 5:V=L.wFn.saw;break;case 2:case 6:V=L.wFn.square;break;default:V=L.wFn.sine}break;case 5:if(o){var N=c.gin(o);i.fineTune={original:N.gft(),instrument:N},N.sft(D)}break;case 6:D?(ve[t]=ve[t]||0,ve[t]<D?(ve[t]++,h.pBr=!0,h.positionBreak=!0,h.targetSongPos=n.position,h.targetPtPos=ce[t]||0):ve[t]=0):ce[t]=n.step;break;case 7:switch(D){case 1:case 5:x=L.wFn.saw;break;case 2:case 6:x=L.wFn.square;break;default:x=L.wFn.sine}break;case 8:case 15:break;case 9:D&&(i.reTrigger={value:D});break;case 10:i.fade={value:D=100*D/64,fine:!0};break;case 11:i.fade={value:-(D=100*D/64),fine:!0};break;case 12:D?D<oe&&(i.cutNote={value:D}):l=!1;break;case 13:if(D)if(D<oe)r+=se*D;else if(l=!1,!c.iFM()&&N&&N.samples&&N.samples[0]){let e=N.samples[0];e.loop.enabled&&e.loop.length&&(i.offset={value:e.loop.start,stepValue:e.loop.start},l=!0)}break;case 14:h.pD=D}break;case 15:case 21:case 25:case 29:case 33:break;case 16:g=Math.min(g,64),c.isPlugin||L.setMasterVolume(g/64,r);break;case 17:m=g>>4,v=15&g;var _=64*L.gLM(),G=0;if(m){var U=r+m*se;G=m*(oe-1)}else v&&(U=r+v*se,G=-v*(oe-1));G&&(g=(_+G)/64,g=Math.max(0,g),g=Math.min(1,g),L.slideMasterVolume(g,U));break;case 20:c.iFM()&&(d=N||c.gin(de[t].currentiN),e.param&&e.param>=oe||(l=!1,d?e.param?(i.noteOff={value:e.param},l=!0):a=p=d.noteOff(r,de[t]):a=0));break;case 27:i.reTrigger={value:e.param}}return l&&o&&s&&(be(t,r),de[t]={},N&&(de[t]=N.play(u,s,p,t,i,r)),fe[t].defaultSlideTarget=de[t].startPrd),o&&(de[t].currentiN=o,i.fineTune&&i.fineTune.instrument&&i.fineTune.instrument.sft(i.fineTune.original||0)),N&&N.hasVibrato()&&(de[t].hasAutoVibrato=!0),de[t].effects=i,de[t].note=e,h}function be(e,t){try{if(de[e].source){var r=de[e].volume.gain;r.setValueAtTime(de[e].cV/100,t-.002),r.linearRampToValueAtTime(0,t+.01),de[e].source.stop(t+.02)}}catch(n){}}function Te(e,t){var r=c.gin(e.iI);if(r){var n=-r.vibrato.rate/40,a=r.vibrato.depth/8;if(c.ulf&&(a*=4),e.vibratoTimer=e.vibratoTimer||0,r.vibrato.sweep&&e.vibratoTimer<r.vibrato.sweep)a*=1-(r.vibrato.sweep-e.vibratoTimer)/r.vibrato.sweep;var i=r.getAutoVibratoFunction()(t,e.vibratoTimer,n,a);return e.vibratoTimer++,i}return t}function Fe(e,t){var r=de[e],n=r.effects;if(r&&n){var a,i=!1;if(r.startVibratoTimer=r.vibratoTimer||0,r.resetPrdOnStep&&r.source)c.setPrdAtTime(r,d=r.currentPrd||r.startPrd,t),r.resetPrdOnStep=!1;if(n.volume){var o=n.volume.value;r.volume&&r.volume.gain.setValueAtTime(o/100,t),r.cV=o}if(n.panning&&(255===(a=n.panning.value)&&(a=254),r.panning&&r.panning.pan.setValueAtTime((a-127)/127,t)),n.fade){var s;a=n.fade.value;var u=1;s=n.fade.resetOnStep?r.startVolume:r.cV;var p=oe;n.fade.fine&&(u=0,p=1);for(var l=u;l<p;l++)r.volume&&(r.volume.gain.setValueAtTime(s/100,t+l*se),s+=a,s=Math.max(s,0),s=Math.min(s,100));r.cV=s}if(n.slide&&r.source){var d=g=r.currentPrd||r.startPrd;p=oe;n.slide.fine&&(p=2);var f,m=n.slide.value;if(c.iFM()&&c.ulf&&(m=4*n.slide.value),a=Math.abs(m),c.iFM()&&n.slide.resetVolume&&(r.vFO||r.ve))(f=c.gin(r.iI))&&f.resetVolume(t,r);r.vibratoTimer=r.startVibratoTimer;for(l=1;l<p;l++){n.slide.target?(fe[e].defaultSlideTarget=n.slide.target,d<n.slide.target?(d+=a)>n.slide.target&&(d=n.slide.target):(d-=a)<n.slide.target&&(d=n.slide.target)):(d+=m,fe[e].defaultSlideTarget&&(fe[e].defaultSlideTarget+=m)),c.iFM()||(d=L.limitAmigaPrd(d));var v=d;n.slide.canUseGlissando&&fe[e].glissando&&(v=L.getNearestSemiTone(d,r.iI)),d!==r.currentPrd&&(r.currentPrd=d,r.hasAutoVibrato&&c.iFM()&&(d=Te(r,v),i=!0),c.setPrdAtTime(r,v,t+l*se))}}if(n.arpeggio&&r.source){var g=r.currentPrd||r.startPrd;r.resetPrdOnStep=!0,r.vibratoTimer=r.startVibratoTimer;for(l=0;l<oe;l++){var h=l%3;0==h&&(d=g),1==h&&n.arpeggio.interval1&&(d=g-n.arpeggio.interval1),2==h&&n.arpeggio.interval2&&(d=g-n.arpeggio.interval2),r.hasAutoVibrato&&c.iFM()&&(d=Te(r,d),i=!0),c.setPrdAtTime(r,d,t+l*se)}}if(n.vibrato||r.hasAutoVibrato&&!i){n.vibrato=n.vibrato||{freq:0,amplitude:0};var P=n.vibrato.freq,b=n.vibrato.amplitude;if(c.iFM()&&c.ulf&&(b*=4),r.vibratoTimer=r.vibratoTimer||0,r.source){r.resetPrdOnStep=!0,g=r.currentPrd||r.startPrd,r.vibratoTimer=r.startVibratoTimer;for(l=0;l<oe;l++)d=V(g,r.vibratoTimer,P,b),r.hasAutoVibrato&&c.iFM()?(d=Te(r,d),i=!0):r.vibratoTimer++,c.setPrdAtTime(r,d,t+l*se)}}if(n.tremolo){P=n.tremolo.freq,b=n.tremolo.amplitude;if(r.tremoloTimer=r.tremoloTimer||0,r.volume){var T=r.startVolume;for(l=0;l<oe;l++)(T=x(T,r.tremoloTimer,P,b))<0&&(T=0),T>100&&(T=100),r.volume.gain.setValueAtTime(T/100,t+l*se),r.cV=T,r.tremoloTimer++}}if(n.cutNote){if(r.volume){let e=t+n.cutNote.value*se;r.volume.gain.setValueAtTime(r.cV/100,e),r.volume.gain.linearRampToValueAtTime(0,e+.005)}r.cV=0}if(n.noteOff)(f=c.gin(r.iI))&&(r.cV=f.noteOff(t+n.noteOff.value*se,r));if(n.reTrigger){var F=r.iI,y=r.startPrd;o=r.startVolume;for(var S=r.noteIndex,A=n.reTrigger.value||1,C=A;C<oe;){var w=t+C*se;be(e,w),de[e]=L.playSample(F,y,o,e,n,w,S),C+=A}}}}function ye(){H.tr(T,0),H.tr(b,0),c.sAS(6),c.setBPM(125),V=L.wFn.sine,x=L.wFn.sine,fe=[],de=[];for(var e=0;e<ue;e++)de.push({}),fe.push({});c.ulf=!1,c.strM(_,!0),c.isPlugin||L.setMasterVolume(1),L.setAmigaLowPassFilter(!1,0),"undefined"!=typeof StateManager&&StateManager.clear()}function Se(){for(var e=[],t=0;t<pe;t++){var r,n=[];for(r=0;r<ue;r++)n.push(z());e.push(n)}return e}return c.init=function(e){for(var t=0;t<ue;t++)de.push({}),fe.push({});for(t=-8;t<8;t++)Z[t]={};for(var r in D)if(D.hasOwnProperty(r)){var n=D[r];if(X[n.prd]=n,J[n.name]=n,Y.push(n.name),n.tune)for(t=-8;t<8;t++){Z[t][n.tune[t+8]]=n.prd}}var a=0;for(r in N)if(N.hasOwnProperty(r)){var i=N[r];i.prd||(i.prd=1),Q.push(i),$[i.prd]=a,i.modPrd&&($[i.modPrd]=a),a++}e&&L.init(e.audioContext,e.audioDestination)},c.setCriNIndex=function(t){if(v.instruments[t])g!=(R=t)&&H.tr(e,R),g=R;else if(t<=c.getMaxiNs()){for(var r=v.instruments.length,n=t;r<=n;r++)c.setiN(r,q());var a=[];for(r=1;r<=n;r++){a.push({label:r+" "+(v.instruments[r]||{name:""}).name,data:r}),H.tr(m,a)}g!=(R=t)&&H.tr(e,R),g=R}},c.getCriNIndex=function(){return R},c.getCriN=function(){return O[R]},c.getMaxiNs=function(){return c.iFM()?128:31},c.setCrPt=function(e){(k=v.patterns[W=e])||(k=Se(),v.patterns[W]=k),pe=k.length,A!=W&&H.tr(t,W),A=W},c.getCrPt=function(){return W},c.getCrPtData=function(){return k},c.setCrPtPos=function(e){C!=(te=e)&&H.tr(r,{current:te,prev:C}),C=te},c.getCrPtPos=function(){return te},c.getCrSongPos=function(){return ne},c.setCurrentSongPosition=function(e,t){(ne=e)!=ae&&(H.tr(i,ne),v.patternTable&&c.setCrPt(v.patternTable[ne]),ae=ne,t&&c.isPlaying()&&(c.stop(),c.togglePlay()))},c.setPlayType=function(e){H.tr(a,re=e)},c.getPlayType=function(){return re},c.playSong=function(){c.stop(),L.checkState(),c.setPlayType(F),E=!0,ge(W),H.tr(n,E)},c.playPt=function(){c.stop(),L.checkState(),te=0,c.setPlayType(y),E=!0,ge(W),H.tr(n,E)},c.stop=function(){u&&u.stop(),L.disable(),c.isPlugin||L.setMasterVolume(1),c.cEC();for(var e=0;e<ue;e++)if(de[e].source)try{de[e].source.stop()}catch(t){}H.tr(n,E=!1)},c.pause=function(){u&&u.stop(),H.tr(n,E=!1)},c.togglePlay=function(){c.isPlaying()?c.stop():re==y?c.playPt():c.playSong()},c.getProperties=function(){return{ticksPerStep:oe,tickTime:se}},c.cutNote=be,c.setBPM=function(e,t){var r=t&&t.isMaster;c.isMaster||r?(u&&u.timeStretch(L.context.currentTime,[M],ie/e),r||H.tr(T,ie),se=2.5/(ie=e),H.tr(s,ie)):H.tr(T,e)},c.sAS=function(e,t){c.isMaster||t&&t.isMaster?(oe=e,H.tr(o,e)):H.tr(b,e)},c.getPtLength=function(){return pe},c.setPtLength=function(e){var r=v.patterns[W].length;if(r!==(pe=e)){if(r<pe)for(var n=r;n<pe;n++){var a,i=[];for(a=0;a<ue;a++)i.push(z());v.patterns[W].push(i)}else v.patterns[W]=v.patterns[W].splice(0,pe),te>=pe&&c.setCrPtPos(pe-1);H.tr(t,W)}},c.getTrackCount=function(){return ue},c.setTrackCount=function(e){ue=e;for(var t=de.length;t<ue;t++)de.push({});for(t=fe.length;t<ue;t++)fe.push({});H.tr(l,ue)},c.isPlaying=function(){return E},c.setStateAtTime=function(e,t){me.push({time:e,state:t})},c.getStateAtTime=function(e){for(var t=void 0,r=0,n=me.length;r<n;r++){if(!(me[0].time<e))return t;t=me.shift().state}return t},c.getTimeStates=function(){return me},c.setPrdAtTime=function(e,t,r){if(t=Math.max(t,1),c.iFM()&&c.ulf)var n=8363*Math.pow(2,(4608-t)/768)/L.context.sampleRate;else n=e.startPrd/t,n*=e.sPR;e.source.playbackRate.setValueAtTime(n,r),e.source.playbackRate.setValueAtTime(n,r+.005)},c.processFile=function(e,t,r){return new Promise((async n=>{var a,i=S;e instanceof ArrayBuffer?(a=new U(e,!0),i=K.detect(a,t)):e&&e.modules&&(i={name:"PLAYLIST",type:w}),i.isMod&&i.loader&&(c.isPlaying()&&c.stop(),ye(),(v=i.loader().load(a,t)).filename=t,v.url=r,function(){v.channels&&c.setTrackCount(v.channels);C=void 0,g=void 0,A=void 0,ae=void 0,c.setCurrentSongPosition(0),c.setCrPtPos(0),c.setCriNIndex(1),c.cEC(),H.tr(d,v),H.tr(p,v)}()),n(i.type)}))},c.getSong=function(){return v},c.gins=function(){return O},c.gin=function(e){return O[e]},c.setiN=function(e,t){t.iI=e,O[e]=t},c.getCrUrl=function(){return v.url},c.cEC=function(){fe=[];for(var e=0;e<ue;e++)fe.push({})},c.cleariNs=function(t){if(v){var r=[],n=t||v.instruments.length-1;O=[];for(let e=1;e<=n;e++)c.setiN(e,q()),r.push({label:e+" ",data:e});v.instruments=O,H.tr(m,r),H.tr(e,R)}},c.strM=function(e,t){var r=function(){le=e,I.eB=!c.iFM(),H.tr(f,e)};e!==_||t?r():ee.gins().length>32||r()},c.iFM=function(){return le===G},c.reset=function(){ye()},c.cleariN=function(){O[R]=q(),H.tr(e,R)},c.ulf=!0,c}();let te=(()=>{let e,t=ee;return t.load=async t=>{e||(ee.init(),L.init(),e=!0);let r=await fetch(t).then((e=>e.arrayBuffer()));ee.processFile(r).then((e=>e))},t.play=()=>{ee.playSong()},t.audio=L,window.BassoonTracker=t,t})();export{te as default};
